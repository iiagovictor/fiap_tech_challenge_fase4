version: "3.9"

services:

  # API de previsão de preços de ações usando modelo LSTM treinado
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: lstm_stock_api
    ports:
      - "8000:8000"
    environment:
      MODEL_PATH:  /app/models/lstm_stock_model.h5
      SCALER_PATH: /app/models/scaler.pkl
    volumes:
      - ./models/lstm_stock_model.h5:/app/models/lstm_stock_model.h5:ro
      - ./models/scaler.pkl:/app/models/scaler.pkl:ro
    healthcheck:
      test: ["CMD", "python", "-c",
             "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 30s
      timeout:  10s
      retries:  3
      start_period: 20s
    restart: unless-stopped
